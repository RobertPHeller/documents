                                                1 Introduction

   This Technical Note contains informative discussion and background for the corresponding S 9.x.1
   Standard. This Technical Note is not normative in any way.

                                        2 Annotations to the Standard

   This section provides background information on corresponding sections of the S 9.x.1 Standard document.

2.1 Intended Use

   There is no intention that devices that connect more than on CAN segment (e.g. bridges) have to
   electrically interconnect those separate segments.  

   We don't discuss CAN terminators, because they're discussed in detail in the CAN documentation that the
   standard references.  A simple resistor on a RJ45 plug can be used, or more complex devices can be
   created and sold that e.g. contain diagnostic readouts.  So long as it provides in-spec termination,
   they're all fine.

2.2 References and Context

   NMRA conformance testing is simplified when it can be done by referring to vendor documentation, rather
   than requiring specific tests of parameters.  The standard therefore refers to other to existing
   standards, where possible, instead of repeating the information here.

2.3 Physical Interconnection

   We're trying to enable two basic kinds of nodes:   Board with 2 connectors and box with a pig-tail
   cable, e.g. a handheld throttle.  But we don't want to rule out e.g. a board with two connectors and
   three pig-tails for attaching throttles, or anything else, hence the somewhat complex wording in this
   section.

   The assignments to particular colors are for information only. These are the colors that users will
   encounter in the two popular ways of wiring commercial cables.  If you're building a product using
   commercial cable, using one of these two color codes will reduce confusion, but most NMRAnet users will
   never need to refer to the colors in their cables.

   The signal names refer back to the signal definitions in the CAN specifications. UTP is unshielded
   cable, so the CAN_SHIELD conductor is being used as a second conductor for the CAN ground reference,
   CAN_GND.

   The discussion of connecting in parallel is to make sure that all 8 wires go through a board, whether
   it's got connectors, pig-tail cables or a combination of the two, so long as it's got more than one
   connection to other nodes.

   We want all 8 wires present so people can add power later, or we can define the reserved conductors
   later, and still use them. The 1A on interconnects is to make sure they're at least as robust as the
   connectors and cable.

   For information on sizing circuit board traces to carry the required interconnection current, please see
   “IPC-2152 — Standard for Determining Current-carrying Capacity in Printed Board Design, 2009.”

   All 8 wires don't have to go through the board if there's only one connection, e.g. a throttle with a
   single jack or pig-tail cable with plug. In that case, only two pairs are required.

   If your product is providing power and has e.g. two jacks, you can either connect them together and
   provide a max of 0.5A to both combined, or separately power them up to 0.5A each. This is the only case
   where a conductor doesn't have to pass through the board as a continuous electrical circuit. Note that
   this means that your product has to provide power, however; if providing power is an option, not always
   present, you should connect conductor 8 across the board to ensure that downstream nodes aren't cut off
   from power when it's not provided by your board.

   The 100V requirement on the reserved conductors is also there to make sure that when we later find a use
   for it, we don't blow up existing installations. The goal is to have all existing installations be able
   to move to newly-defined uses without having to retrofit cables nor non-involved nodes.

   If you want to use the reserved conductors for experimental purposes, we recommend using jumpers (fixed
   or movable) for making connections to the conductors and/or splitting the reserved conductors between
   connectors so that you can restore normal usage later, should some other use be defined for them.  

   The 27V requirement comes from the S9.1 limitation on track voltage.

2.4 Data Transport

   A 4V/microsecond slew rate is preferred to reduce the effect of stubs on the network.

   This standard is silent on the use of specific CAN frame formats or features.

2.5 Supply of Power

   The power supply section is meant to define a 12V nominal system with wide margins on production and
   consumption of power over the UTP cable. We expect that nodes will use this power in a range of ways,
   including having local power regulation ranging from simple analog regulators through more advanced
   supplies that increase current and/or voltage. 12V was chosen to reduce heat loads when using the
   simplest regulators.  The current limit was required by use of 1 conductor in UTP wiring.

   Power can be injected into the cable by simple “mid-span injector” devices, essentially just two RJ45
   connectors and a 2.1mm jack for a wall-wart. It's not required that it comes from a NMRAnet node itself.

   Note that the standard permits, but does not require, connecting the CAN signal ground on conductors 3 &
   6 with the PWR_NEG power distribution ground on conductor 7. We expect that most power-supplying and
   power-consuming boards will connect PWR_NEG and the 3/6 grounds to simplify their internal structure.
   Designers should carefully consider noise immunity, the possibility of ground loop, and voltage offsets
   when doing this. A straight copper connection is within the letter of the requirement. An alternative to
   connecting them directly is e.g. a 10 ohm resistor and a 0.1uF capacitor in parallel.

   The power provisions are for low-power uses that can be conveniently handled over short lengths of
   cable.  Boards are welcome to have other connectors for power. These other connectors can be anything
   not otherwise forbidden by some other standard, including terminal blocks, 2.1mm jacks, Anderson
   PowerPole connectors, or whatever else is considered useful for the specific market.

   Note the effect of the “must withstand” requirement is that power supply boards must be able to be
   connected to each other, even if their output voltages are not exactly the same. One way to handle this
   is an isolating diode on the PWR_POS output.

2.6 Consumption of Power

   For their thermal calculations, node designers must assume that power is supplied at 15V.

   For their power calculations, node designers must assume that power is supplied at 7.5V.

                                                3 Termination

    The CAN specification (ISO11898-2 section 7.1 and section 7.5.2) specifies using a bus termination of
   120±10 ohms located at each end of the bus..  Several alternate termination schemes have been proposed
   in the literature (see references), and these alternatives are discussed below.   

3.1 Methods

  3.1.1 Passive single resistor:  

   This consists simply of a 120 ohm connected etween CAN-H and CAN-L, and is the commonest termination
   scheme.  It main advantage is simplicity.  

  3.1.2 Passive split resistors to ground: 

   This consists of the CAN-L and CAN-H lines being connected by two 60 ohm resistors in series, with their
   common connected via a capacitor to ground.   This is simple but also  helps balance the two lines.  

  3.1.3 Passive split resistors to fixed voltage: 

   As in (2), but common is also tied to a fixed voltage. This can be to nominal 2.5V via a voltage divider
   (ref http://ww1.microchip.com/downloads/en/AppNotes/00228a.pdf), or by other means, by using a voltage
   reference.  Unfortunately, this may lead to problems if there is a large ground offset between two
   nodes.  

  3.1.4 Active termination: 

   This termination is accomplished by using active elements, such as transistors or op-amps to  actively
   drive the bus to its active state.   Although theoretically possible, this has not been used on CAN.
    Note: active termination requires power.  

  3.1.5 Distributed termination: 

   This is not appropriate for MRR, since it requires a fixed number of nodes.  

3.2 Placement:   

   Any termination can be supplied as a on-board option, or as a terminator- connector.  Obviously, this is
   based on the preferences of the manufacturer and  users. Using terminator-plugs would seem to provide
   the maximum flexibility.  However, as long as on-board termination is de-selectable, flexibility is
    maintained. Manufacturers may want to provide a special termination node that  as well as providing
   passive or active termination, also provides some  indication of bus health.  

   Termination should, generally, only occur at the two distant ends of the bus, termination in the middle
   of a significant-length CAN bus is very disruptive because it causes reflections.  The one downside to
   on-board termination is that it makes it much easier to have multiple terminators (customers think more
   must be good, and mistakenly turn them all on).  Note that ISO11898-2 states "The locating of the
   termination within a CAN node should be avoided because the bus lines lose termination if this node is
   disconnected from the bus line."

                                      4 Repeaters, Bridges and Gateways

   A CAN segment is a set of directly-connected cables that is shared by multiple nodes with
   directly-connected transceivers. Any node on the segment can communicate with any other node. A CAN
   segment has limited length, number of nodes and stub connections due to timing and electrical properties
   of the cables and transceivers.

   Repeaters, bridges and gateways are methods for connecting two or more CAN segments so that any node can
   communicate with any node on any of the connected segments. This section provides some background
   information on the three technologies.  Note that the terminology is somewhat flexible, and not all
   manufacturers refer to their products in the same way.

   In each section, URLs are provided for a few example devices. Inclusion of a device in this section is
   not a recommendation, positive or negative, for the device. No inferences should be draw from a device
   being or not being included in this section.

4.1 Repeaters

   A short CAN segment with many nodes may run out of electrical drive without reaching the timing
   limitations of the CAN protocol.  In this case, a repeater may be used to connect a second segment
   containing more nodes.  The repeater effectively boosts the electrical signals moving from one segment
   to the other, so that the nodes on one side appear as only a single electrical load on the other.

   Doing this takes a small amount of time, so use of repeaters reduces the total possible end-to-end
   length of the combined CAN segments, typically around 30 m / 100 ft.  Under certain circumstances, they
   can be used to add long stubs to a CAN network; doing this successfully requires detailed understanding
   of CAN characteristics.

   Repeaters are sometimes referred to as “working at the bit level”.  The CAN transmission is delayed by
   less than a bit time, and the CAN arbitration process still works between nodes on the two segments.

   http://www.softing.com/home/en/industrial-automation/products/can-bus/more-can-bus/high-speed/iso-11898-2-repeater.php

   http://www.ixxat.com/introduction-repeater_en.html

   http://www.esd-electronics-usa.com/shared/datasheets/repeat-e.pdf

   http://www.ixxat.com/can_cr200_en.html

4.2 Bridges

   A bridge looks like an independent CAN node on each of two or more CAN segments, receiving frames on a
   segment and sending them independently on the others. As such, it allows connection of two or more full
   size, full node-count CAN segments.s

   Bridges are sometimes referred to as “working at the frame level”.  The CAN transmission is delayed by
   more than a bit time, usually a frame time or longer.

   The CAN arbitration process takes place on each segment independently, and is not shared between the
   separate segments; frames will appear in different order on the various segments. The protocol(s)
   running on the CAN segments must be compatible with this reordering.

   Because bridges break the timing connection between the connected segments, they can also be used for
   remote connections via non-CAN cables, wireless, etc.  In this case, a bridge device is usually used at
   each end of the remote link, and the protocol between the two devices is specific to the CAN bridge
   function.

   http://www.ixxat.com/introduction_bridges_en.html

   http://www.ieee-icnp.org/1996/papers/1996-21.pdf

   http://doi.ieeecomputersociety.org/10.1109/ISPAN.1996.509033

   http://www.ixxat.com/can_bridge_en.html

   http://www.wrcakron.com/devicenet/CAN_Bus_Applications.pdf

   http://www.matric.com/canbridge.html

4.3 Gateways

   Gateways connect a CAN segment to another communication technology, such as IP over wireless, Ethernet
   or some other. In the process, they may reformat or translate the CAN frames as needed. For example, a
   USB-CAN adapter may convert the CAN frame bytes into some form of human-readable text.

   This reformatting may be independent of the CAN frame content information, or specific to some protocol
   that defines meaning for the CAN frames.

   http://www.phytec.com/products/can/pc-can-interfaces/CAN-Ethernet-Gateway.html

   http://news.thomasnet.com/fullstory/Gateway-converts-from-CAN-into-Ethernet-529941

   http://www.icpdas-usa.com/products.php?PID=3075

                                                 5 References

   This section provides references, and when possible URLs, that may be of use to NMRAnet implementors.

5.1 Standards

   The S 9.x.1 standard references ISO 11898-1 and ISO 11898-2 for CAN specifications.  The ISO
   (http://www.iso.org) sells PDF and paper copies of these. Copies can generally be found in engineering
   libraries.

   Note that ISO 11898-3, 11898-4 and 11898-5 specify different variants of the CAN standard that are not
   relevant to S 9.x.1 compliant implementations.  The original 1995 Bosch CAN standard, which can be found
   online, is similar to IS 11898-1 and -2, but not identical.

   The S 9.x.1 standard references TIA/EIA-568-B or the successor TIA/EIA- 568-C for unshielded twisted
   pair (UTP) cable, and TIA-968-A for RJ45 modular plugs and jacks.  The TIA (http://www.tiaonline.org)
   sells PDF and paper copies of these. Copies can generally be found in engineering libraries.

5.2 Application Notes

   A number of component manufacturers have written application notes that may be useful to NMRAnet
   developers.  A list is provided here for reference, but please note that none of these are normative;
   for specific values, etc, please refer to the standards listed above.

  5.2.1 Anixter

   “ANSI/TIA/EIA-568-B Standards Reference Guide”
   (http://www.anixter.com/AXECOM/AXEDocLib.nsf/(UnID)/8F2E0839A6190F4986257309005757CC/$file/ANSI-TIA-EIA-568-B.pdf)

  5.2.2 Mohawk.com

   “ANSI/TIA/EIA-568-B (B.1, B.2 and B.3) Commercial Building Telecommunications Cabling Standard”
   (http://www.mohawk-cable.com/support/ansi-tia-eia-568-b.html)

  5.2.3 Microchip Corp

   AN713 “Controller Area Network (CAN) Basics” (http://ww1.microchip.com/downloads/en/AppNotes/00713a.pdf)

   AN228 “A CAN Physical Layer Discussion” (http://ww1.microchip.com/downloads/en/AppNotes/00228a.pdf)

   AN853 “PIC18XXX8 CAN Driver with Prioritized Transmit Buffer”
   (http://ww1.microchip.com/downloads/en/AppNotes/00853a.pdf)

  5.2.4 Philips

   AN96116 “PCA82C250 / 251 CAN Transceiver” (http://www.nxp.com/documents/application_note/AN96116.pdf)

  5.2.5 Texas Instruments

   Analog Applications Journal, August 1999, TI SLYT197 “TIA/EIA-568A Category 5 cables in low-voltage
   differential signaling (LVDS)” (http://focus.ti.com/lit/an/slyt197/slyt197.pdf)

   Application Report SLOA101A “Introduction to the Controller Area Network (CAN)”
   (http://focus.ti.com.cn/cn/lit/an/sloa101a/sloa101a.pdf)

   Application Report SLLA270 “Controller Area Network Physical Layer Requirements”
   (http://focus.ti.com/lit/an/slla270/slla270.pdf)

   Application Report SLLA298B “Isolated CAN Reference Design”
   (http://focus.ti.com/lit/an/slla298b/slla298b.pdf)

   Application Report SLOU262 “Isolated CAN Transceiver EVM”
   (http://focus.tij.co.jp/jp/lit/ug/slou262/slou262.pdf)

   Analog Applications Journal, 3Q 2006, TI SLYT249 “Improved CAN network security with TI’s SN65HVD1050
   transceiver” (http://focus.ti.com/lit/an/slyt249/slyt249.pdf)

5.3 Component data sheets

   This section lists component data sheets that may be of value to the NMRAnet implementor.  Inclusion of
   a component data sheet in this section is not a recommendation, positive or negative, for the component.
   No inferences should be draw from a component or data sheet being or not being included in this section.

  5.3.1 Microchip

   MCP 2551 High-Speed CAN Transceiver (http://ww1.microchip.com/downloads/en/DeviceDoc/21667f.pdf)

   MCP2515 Stand-Alone CAN Controller With SPI Interface
   (http://ww1.microchip.com/downloads/en/DeviceDoc/21801e.pdf)

  5.3.2 NXP Electronics (Philips)

   PCA82C250 CAN controller interface (http://www.nxp.com/documents/data_sheet/PCA82C250.pdf)

  5.3.3 STMicroelectronics

   L9615 transceiver (http://www.st.com/stonline/products/literature/ds/5637.pdf)

  5.3.4 Texas Instruments

   ISO1050 Isolated CAN Transceiver (http://focus.ti.com/lit/ds/symlink/iso1050.pdf)

   SN55HVD251, SN65HVD251 Industrial CAN Transceiver (http://focus.ti.com/lit/ds/symlink/sn55hvd251.pdf)

   SN65HVD1050 EMC Optimized CAN Transceiver (http://focus.ti.com/lit/ds/symlink/sn65hvd1050.pdf)

    

    

   Table of Contents

   1 Introduction

   2 Annotations to the Standard

   2.1 Intended Use

   2.2 References and Context

   2.3 Physical Interconnection

   2.4 Data Transport

   2.5 Supply of Power

   2.6 Consumption of Power

   3 Termination

   3.1 Methods

   3.1.1 Passive single resistor:  

   3.1.2 Passive split resistors to ground: 

   3.1.3 Passive split resistors to fixed voltage: 

   3.1.4 Active termination: 

   3.1.5 Distributed termination: 

   3.2 Placement:   

   4 Repeaters, Bridges and Gateways

   4.1 Repeaters

   4.2 Bridges

   4.3 Gateways

   5 References

   5.1 Standards

   5.2 Application Notes

   5.2.1 Anixter

   5.2.2 Mohawk.com

   5.2.3 Microchip Corp

   5.2.4 Philips

   5.2.5 Texas Instruments

   5.3 Component data sheets

   5.3.1 Microchip

   5.3.2 NXP Electronics (Philips)

   5.3.3 STMicroelectronics

   5.3.4 Texas Instruments

    
