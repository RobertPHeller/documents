                                                1 Introduction

   This Technical Note contains informative discussion and background for the corresponding S 9.x.1
   Standard. This Technical Note is not normative in any way.

                                        2 Annotations to the Standard

   This section provides background information on corresponding sections of the S 9.x.1 Standard document.

2.1 Intended Use

   The Standard discusses single CAN segments, and is silent on interconnecting multiple segments.  For
   more discussion of options for interconnection, see the “Repeaters, Bridges and Gateways” section below.

   The Standard does not discuss CAN terminators because they're discussed in detail in the CAN literature.
   See the “Termination” section below for more discussion.

2.2 References and Context

   NMRA conformance testing is simplified when it can be done by referring to vendor documentation, rather
   than requiring specific tests of parameters.  The Standard therefore refers to other to existing
   standards, where possible, instead of repeating the information here.

2.3 Physical Interconnection

   The Standard envisions two basic kinds of nodes:   Board with 2 connectors and box with a pig-tail
   cable, e.g. a handheld throttle.  At the same time, the Standard should not rule out e.g. a board with
   two connectors and three pig-tails for attaching throttles, or anything else, hence the somewhat complex
   wording in this section.

   The signal names refer back to the signal definitions in the CAN specifications. UTP is unshielded
   cable, so the CAN_SHIELD conductor is being used as a second conductor for the CAN ground reference,
   CAN_GND.

   The conductor assignments are based on industry practice for RJ45 connectors on CAN networks, c.f.
   Recommendation CiA 303 (2009) of the CAN in Automation e.V. group.

   The assignments to particular wire colors are for information only. These are the wire colors that users
   will encounter in the two popular ways of wiring commercial cables.  When building a product using
   commercial cable, using one of these two color assignments will reduce confusion, but most NMRAnet users
   will never need to refer to the wire colors in their cables.

   The discussion of connecting in parallel is to make sure that all 8 wires go through a board, whether
   it's got connectors, pig-tail cables or a combination of the two, so long as it's got more than one
   connection to other nodes.

   The requirement to have all eight wires present is so people can add power later, or an updated Standard
   can define the reserved conductors later, and still use them. The 1A requirement on interconnects is to
   make sure they're at least as robust as the connectors and cable.

   For information on sizing circuit board traces to carry the required interconnection current, please see
   “IPC-2152 — Standard for Determining Current-carrying Capacity in Printed Board Design, 2009.”

   All 8 wires don't have to go through the board if there's only one connection, e.g. a throttle with a
   single jack or pig-tail cable with plug. In that case, only two pairs are required.

   If a conforming device is providing power and has e.g. two jacks, the device can either connect them
   together and provide a max of 0.5A to both combined, or separately power them up to 0.5A each. This is
   the only case where a conductor doesn't have to pass through the board as a continuous electrical
   circuit. Note that this means that the device has to provide power, however; if providing power is an
   option, not always present, the device should connect conductor 8 across the board to ensure that
   downstream nodes aren't cut off from power when it's not provided by the device.

   The 100V requirement on the reserved conductors is also there to make sure that when a use if defined
   for them late, it doesn't blow up existing installations. The goal is to have all existing installations
   be able to move to newly-defined uses without having to retrofit cables nor non-involved nodes.

   To use the reserved conductors for experimental purposes, consider using jumpers (fixed or movable) for
   making connections to the conductors and/or splitting the reserved conductors between connectors so that
   the user can restore normal usage later, should some other use be defined for the reserved conductors.  

   The 27V requirement comes from the S9.1 limitation on track voltage.

2.4 Data Transport

   A 4V/microsecond slew rate is preferred to reduce the effect of stubs on the network.

   This standard is silent on the use of specific CAN frame formats or features.

2.5 Supply of Power

   The power supply section is meant to define a 12V nominal system with wide margins on production and
   consumption of power over the UTP cable. The Standard is written to allow nodes to use this power in a
   range of ways, including having local power regulation ranging from simple analog regulators through
   more advanced supplies that increase current and/or voltage. 12V was chosen to reduce heat loads when
   using the simplest regulators.  The current limit was required by use of 1 conductor in UTP wiring.

   Power can be injected into the cable by simple “mid-span injector” devices, essentially just two RJ45
   connectors and a 2.1mm jack for a wall-wart. It is not required that power comes from a NMRAnet node
   itself.

   Note that the standard permits, but does not require, connecting the CAN signal ground on conductors 3 &
   6 with the PWR_NEG power distribution ground on conductor 7. Power-supplying and power-consuming boards
   can connect PWR_NEG and the 3/6 grounds to simplify their internal structure. Designers should carefully
   consider noise immunity, the possibility of ground loop, and voltage offsets when doing this. A straight
   copper connection is within the letter of the requirement. An alternative to connecting them directly is
   a filtered connection, e.g. a 10 ohm resistor and a 0.1uF capacitor in parallel.

   The power provisions are for low-power uses that can be conveniently handled over short lengths of
   cable.  Boards are welcome to have other connectors for power. These other connectors can be anything
   not otherwise forbidden by some other standard, including terminal blocks, 2.1mm jacks, Anderson
   PowerPole connectors, or whatever else is considered useful for the specific market.

   Note the effect of the “must withstand” requirement is that power supply boards must be able to be
   connected to each other, even if their output voltages are not exactly the same. One way to handle this
   is an isolating diode on the PWR_POS output.

2.6 Consumption of Power

   For their thermal calculations, node designers must assume that power is supplied at 15V.

   For their power calculations, node designers must assume that power is supplied at 7.5V.

                                               3 Design Issues

   This section contains discussion of issues that a designer may wish to consider when designing an
   NMRAnet product.  Nothing in this section is normative.

3.1 Bus Termination

    The CAN specification (ISO11898-2 section 7.1 and section 7.5.2) specifies using a bus termination
   resistor at each end of the bus of 120 (nominal; minimum 100, maximum 130) ohms and rated for 220mW or
   more.  Several alternate termination schemes have been proposed in the literature, and these
   alternatives are discussed below.   

  3.1.1 Termination Circuits

    3.1.1.1 Passive single resistor

   A single 120±10 ohm resistor of ¼ watt or more capacity can connected between CAN-H and CAN-L.  This
   approach has the advantage of simplicity.

    3.1.1.2 Passive split resistors bypassed to ground

   This consists of the CAN-L and CAN-H lines being connected by two 60 ohm resistors in series, with their
   common connected via a capacitor to ground.  This provides a bypass to ground for common mode noise. The
   tolerance on the individual resistor values is significantly tighter than on their total resistance.
   (http://focus.ti.com/lit/an/slla270/slla270.pdf) 1% tolerance resistors are often used.

    3.1.1.3 Biased split termination

   As in (3.1.1.2), but the common of the resistors is also tied to a fixed voltage. This can be to nominal
   2.5V via a voltage divider (http://ww1.microchip.com/downloads/en/AppNotes/00228a.pdf), or by using a
   voltage reference (http://focus.ti.com.cn/cn/lit/an/sloa101a/sloa101a.pdf).  If there is a significant
   offset of ground between two nodes, then this offset will be transmitted to the CAN lines with
   consequent degradation of common-mode rejection.  

    3.1.1.4 Active termination

   This termination is accomplished by using active elements, such as transistors or op-amps, to  actively
   drive the bus to its proper state.   Because of the recessive component of the ISO 11898-2 CAN signal,
   this form of termination is not appropriate.

    3.1.1.5 Distributed termination

   This technique requires a fixed number of custom-impedance nodes, and is therefore not suitable for
   model railroad applications that are based on user-specific ad-hoc networks made from standard
   components.

  3.1.2 Terminator Placement

   Termination can be supplied as an on-board option, or as a terminator housed within an RJ45 plug, or as
   a separate terminator device, depending on the preferences of the manufacturer and users.

   Using plug-resident terminators would seem to provide the maximum flexibility, but it may be difficult
   to built a split terminator into a RJ45 plug.

   If on-board terminators are provided, it must be possible to enable or disable them depending on where
   the node is installed on the CAN segment.  Termination should only occur at the two distant ends of the
   bus.  Termination in the middle of a significant-length CAN bus is very disruptive because it causes
   reflections.  The one downside to on-board termination is that it makes it much easier to have multiple
   terminators (customers think more must be good, and mistakenly turn them all on).   It's recommended
   that nodes be shipped with on-board terminators disabled, to reduce the chance that a termination load
   will be attached in the middle of the segment.  Note that ISO11898-2 states “The locating of the
   termination within a CAN node should be avoided because the bus lines lose termination if this node is
   disconnected from the bus line.” (Section 5.2.1) and “It is not recommended to integrate the termination
   into a CAN node.” (Section 7.1)

   Manufacturers may want to provide a special termination node to provide some  indication of bus health
   as well as providing termination.  Industrial diagnostic equipment provides some examples of what can be
   done. (http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&nodeId=1406&dDocName=en546534)
   (http://www.ixxat.com/cancheck_en.html?markierung=cancheck)
   (http://www.ixxat.com/can_bus_tester_cbt_en.html)
   (http://www.can-cia.org/pg/can/categories/generic_tool/physical/none/none/index.html)

3.2 EMC Management

   CAN is a robust signaling method developed for use in the difficult environment of automobiles. Issues
   of EMC, noise reduction, etc have been discussed in numerous vendor application notes including, but not
   limited to:

   http://www.nxp.com/documents/application_note/AN10211.pdf

   http://focus.ti.com/lit/an/slla270/slla270.pdf

   See also the “References” section below.

  3.2.1 Chokes

   A series choke or transformer can improve the noise immunity of a CAN transceiver.  The Standard permits
   the use of one, but doesn't require it.  This advantages and disadvantages of including one are
   discussed in the NXP (Philips) and Texas Instruments application notes referenced above. Typical parts
   are the TDK ZJYS81RS-2PL51(T)-G01 and the ZJYS51-2PT.

                                      4 Repeaters, Bridges and Gateways

   A CAN segment is a set of directly-connected cables that is shared by multiple nodes with
   directly-connected transceivers. Any node on the segment can communicate with any other node. A CAN
   segment has limited length, number of nodes and stub connections due to timing and electrical properties
   of the cables and transceivers.

   Repeaters, bridges and gateways are methods for connecting two or more CAN segments so that any node can
   communicate with any node on any of the connected segments. This section provides some background
   information on the three technologies.  Note that the terminology is somewhat flexible, and not all
   manufacturers refer to their products in the same way.

   In each section, URLs are provided for a few example devices. Inclusion of a device in this section is
   not a recommendation, positive or negative, for the device. No inferences should be draw from a device
   being or not being included in this section.

4.1 Repeaters

   A short CAN segment with many nodes may run out of electrical drive without reaching the timing
   limitations of the CAN protocol.  In this case, a repeater may be used to connect a second segment
   containing more nodes.  The repeater effectively boosts the electrical signals moving from one segment
   to the other, so that the nodes on one side appear as only a single electrical load on the other.

   Doing this takes a small amount of time, so use of repeaters reduces the total possible end-to-end
   length of the combined CAN segments, typically around 30 m / 100 ft.  Under certain circumstances, they
   can be used to add long stubs to a CAN network; doing this successfully requires detailed understanding
   of CAN characteristics.

   Repeaters are sometimes referred to as “working at the bit level”.  The CAN transmission is delayed by
   less than a bit time, and the CAN arbitration process still works between nodes on the two segments.

   http://www.softing.com/home/en/industrial-automation/products/can-bus/more-can-bus/high-speed/iso-11898-2-repeater.php

   http://www.ixxat.com/introduction-repeater_en.html

   http://www.esd-electronics-usa.com/shared/datasheets/repeat-e.pdf

   http://www.ixxat.com/can_cr200_en.html

4.2 Bridges

   A bridge looks like an independent CAN node on each of two or more CAN segments, receiving frames on a
   segment and sending them independently on the others. As such, it allows connection of two or more full
   size, full node-count CAN segments.s

   Bridges are sometimes referred to as “working at the frame level”.  The CAN transmission is delayed by
   more than a bit time, usually a frame time or longer.

   The CAN arbitration process takes place on each segment independently, and is not shared between the
   separate segments; frames will appear in different order on the various segments. The protocol(s)
   running on the CAN segments must be compatible with this reordering.

   Because bridges break the timing connection between the connected segments, they can also be used for
   remote connections via non-CAN cables, wireless, etc.  In this case, a bridge device is usually used at
   each end of the remote link, and the protocol between the two devices is specific to the CAN bridge
   function.

   http://www.ixxat.com/introduction_bridges_en.html

   http://www.ieee-icnp.org/1996/papers/1996-21.pdf

   http://doi.ieeecomputersociety.org/10.1109/ISPAN.1996.509033

   http://www.ixxat.com/can_bridge_en.html

   http://www.wrcakron.com/devicenet/CAN_Bus_Applications.pdf

   http://www.matric.com/canbridge.html

4.3 Gateways

   Gateways connect a CAN segment to another communication technology, such as IP over wireless, Ethernet
   or some other. In the process, they may reformat or translate the CAN frames as needed. For example, a
   USB-CAN adapter may convert the CAN frame bytes into some form of human-readable text.

   This reformatting may be independent of the CAN frame content information, or specific to some protocol
   that defines meaning for the CAN frames.

   http://www.phytec.com/products/can/pc-can-interfaces/CAN-Ethernet-Gateway.html

   http://news.thomasnet.com/fullstory/Gateway-converts-from-CAN-into-Ethernet-529941

   http://www.icpdas-usa.com/products.php?PID=3075

                                                 5 References

   This section provides references, and when possible URLs, that may be of use to NMRAnet implementors.

5.1 Standards

   The S 9.x.1 standard references ISO 11898-1 and ISO 11898-2 for CAN specifications.  The ISO
   (http://www.iso.org) sells PDF and paper copies of these. Copies can generally be found in engineering
   libraries.

   Note that ISO 11898-3, 11898-4 and 11898-5 specify different variants of the CAN standard that are not
   relevant to S 9.x.1 compliant implementations.  The original 1995 Bosch CAN standard, which can be found
   online, is similar to IS 11898-1 and -2, but not identical.

   The S 9.x.1 standard references TIA/EIA-568-B or the successor TIA/EIA- 568-C for unshielded twisted
   pair (UTP) cable, and TIA-968-A for RJ45 modular plugs and jacks.  The TIA (http://www.tiaonline.org)
   sells PDF and paper copies of these. Copies can generally be found in engineering libraries.

5.2 Application Notes

   A number of component manufacturers have written application notes that may be useful to NMRAnet
   developers.  A list is provided here for reference, but note that none of these are normative; for
   specific values, etc, please refer to the standards listed above.

  5.2.1 Anixter

   “ANSI/TIA/EIA-568-B Standards Reference Guide”
   (http://www.anixter.com/AXECOM/AXEDocLib.nsf/(UnID)/8F2E0839A6190F4986257309005757CC/$file/ANSI-TIA-EIA-568-B.pdf)

  5.2.2 Mohawk.com

   “ANSI/TIA/EIA-568-B (B.1, B.2 and B.3) Commercial Building Telecommunications Cabling Standard”
   (http://www.mohawk-cable.com/support/ansi-tia-eia-568-b.html)

  5.2.3 Microchip Corp

   AN713 “Controller Area Network (CAN) Basics” (http://ww1.microchip.com/downloads/en/AppNotes/00713a.pdf)

   AN228 “A CAN Physical Layer Discussion” (http://ww1.microchip.com/downloads/en/AppNotes/00228a.pdf)

   AN853 “PIC18XXX8 CAN Driver with Prioritized Transmit Buffer”
   (http://ww1.microchip.com/downloads/en/AppNotes/00853a.pdf)

  5.2.4 Philips

   AN96116 “PCA82C250 / 251 CAN Transceiver” (http://www.nxp.com/documents/application_note/AN96116.pdf)

   AN10211 “TJA1040 high speed CAN transceiver” (http://www.nxp.com/documents/application_note/AN10211.pdf)

  5.2.5 Texas Instruments

   Analog Applications Journal, August 1999, TI SLYT197 “TIA/EIA-568A Category 5 cables in low-voltage
   differential signaling (LVDS)” (http://focus.ti.com/lit/an/slyt197/slyt197.pdf)

   Application Report SLOA101A “Introduction to the Controller Area Network (CAN)”
   (http://focus.ti.com.cn/cn/lit/an/sloa101a/sloa101a.pdf)

   Application Report SLLA270 “Controller Area Network Physical Layer Requirements”
   (http://focus.ti.com/lit/an/slla270/slla270.pdf)

   Application Report SLLA298B “Isolated CAN Reference Design”
   (http://focus.ti.com/lit/an/slla298b/slla298b.pdf)

   Application Report SLOU262 “Isolated CAN Transceiver EVM”
   (http://focus.tij.co.jp/jp/lit/ug/slou262/slou262.pdf)

   Analog Applications Journal, 3Q 2006, TI SLYT249 “Improved CAN network security with TI’s SN65HVD1050
   transceiver” (http://focus.ti.com/lit/an/slyt249/slyt249.pdf)

5.3 Component data sheets

   This section lists component data sheets that may be of value to the NMRAnet implementor.  Inclusion of
   a component data sheet in this section is not a recommendation, positive or negative, for the component.
   No inferences should be draw from a component or data sheet being or not being included in this section.

  5.3.1 Microchip

   MCP 2551 High-Speed CAN Transceiver (http://ww1.microchip.com/downloads/en/DeviceDoc/21667f.pdf)

   MCP2515 Stand-Alone CAN Controller With SPI Interface
   (http://ww1.microchip.com/downloads/en/DeviceDoc/21801e.pdf)

  5.3.2 NXP Electronics (Philips)

   PCA82C250 CAN controller interface (http://www.nxp.com/documents/data_sheet/PCA82C250.pdf)

  5.3.3 STMicroelectronics

   L9615 transceiver (http://www.st.com/stonline/products/literature/ds/5637.pdf)

  5.3.4 Texas Instruments

   ISO1050 Isolated CAN Transceiver (http://focus.ti.com/lit/ds/symlink/iso1050.pdf)

   SN55HVD251, SN65HVD251 Industrial CAN Transceiver (http://focus.ti.com/lit/ds/symlink/sn55hvd251.pdf)

   SN65HVD1050 EMC Optimized CAN Transceiver (http://focus.ti.com/lit/ds/symlink/sn65hvd1050.pdf)

5.4 Tools

   This section lists tools and diagnostic equipment that may be of value to the NMRAnet implementor.
    Inclusion of an item in this section is not a recommendation, positive or negative, for the item. No
   inferences should be draw from an item being or not being included in this section.

  5.4.1 Microchip

   CAN BUS Analyzer Tool “simple to use low cost CAN bus monitor”
   (http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&nodeId=1406&dDocName=en546534)

  5.4.2 IXAAT

   CANcheck “Installation tester for CAN networks”
   (http://www.ixxat.com/cancheck_en.html?markierung=cancheck)

   CAN Bus Tester “Diagnostic tool for long-term monitoring of CAN bus systems”
   (http://www.ixxat.com/can_bus_tester_cbt_en.html)

    

    

   Table of Contents

   1 Introduction

   2 Annotations to the Standard

   2.1 Intended Use

   2.2 References and Context

   2.3 Physical Interconnection

   2.4 Data Transport

   2.5 Supply of Power

   2.6 Consumption of Power

   3 Design Issues

   3.1 Bus Termination

   3.1.1 Termination Circuits

   3.1.1.1 Passive single resistor

   3.1.1.2 Passive split resistors bypassed to ground

   3.1.1.3 Biased split termination

   3.1.1.4 Active termination

   3.1.1.5 Distributed termination

   3.1.2 Terminator Placement

   3.2 EMC Management

   3.2.1 Chokes

   4 Repeaters, Bridges and Gateways

   4.1 Repeaters

   4.2 Bridges

   4.3 Gateways

   5 References

   5.1 Standards

   5.2 Application Notes

   5.2.1 Anixter

   5.2.2 Mohawk.com

   5.2.3 Microchip Corp

   5.2.4 Philips

   5.2.5 Texas Instruments

   5.3 Component data sheets

   5.3.1 Microchip

   5.3.2 NXP Electronics (Philips)

   5.3.3 STMicroelectronics

   5.3.4 Texas Instruments

   5.4 Tools

   5.4.1 Microchip

   5.4.2 IXAAT

    
