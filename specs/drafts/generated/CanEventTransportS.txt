                                         1 Introduction (Informative)

   This specification describes the protocol for transporting OpenLCB events across the OpenLCB network.

                                         2 Intended Use (Informative)

   Transporting events provides general and flexible messaging between nodes, following the principles of
   the Producer-Consumer modeli.  The information is carried by an event ID (number), which in of itself
   does not have any explicit information.  Instead the event ID is assigned by the user to one specific
   concept, such as a specific LED lighting, or a more abstract concept, such as the “start of the day” or
   “global stop”.   That concept can then be implemented by a number of nodes, called consumer nodes, and
   triggered by a number of other nodes called producer nodes.  

                                     3 References and Context (Normative)

   This specification is in the context of the following OpenLCB-CAN Specifications:

   The OpenLCB Message Network Specification, which defines the basic messages and how they interact.
   Higher-level protocols are based on this message network, but are defined elsewhere. Includes
   Initialized State.

   The OpenLCB Node Identifier Specification, which specifies …

   The OpenLCB Event Identifier Specification, which specifies ...

                                        4 Message Formats (Normative)

    

   “EventID with mask” relies on low order 0 or 1 bits to specify the active sense of the effective masking
   operation.  If the lowest bit is a '0', then all low order contiguous '0' bits will form a mask, while
   if the lowest bit is a '1', then the low order contiguous '1' bits will form the mask.  

    

    

4.1 Producer/Consumer Event Report (PCER)

   This message transports an Event-number from a producer node(s) to zero or more unspecified consumer
   nodes.  

                                                               Common                          
   Name                           Dest ID Event ID Simple Node        CAN format  Data Content
                                                               MTI    
   Producer/Consumer Event Report N       Y        N           0x0000 0x1800,0sss EventID      

    

4.2 Identify Consumer

   This message is broadcast and requests every node to report if they consume this event ID.  

                                                  Common                          
   Name              Dest ID Event ID Simple Node        CAN format  Data Content
                                                  MTI    
   Identify Consumer N       Y        N           0x0000 0x1800,0sss Event ID     

4.3 Consumer Identified

   This message is broadcast, in response to a received Identify Consumer message, from each node that
   consumes the included event ID.  This is one of the messages that allows bridges to do automatic routing
   of event messages.  

                                                    Common                          
   Name                Dest ID Event ID Simple Node        CAN format  Data Content
                                                    MTI    
   Consumer Identified N       Y        N           0x0000 0x1800,0sss Event ID     

    

   Coverage of status bits...

4.4 Consumer Range Identified

   This message broadcasts, in response to a received Identify Consumer message, from each node that
   consumes event is in the range specified by the included event-ID-with-mask..  This is one of the
   messages that allows bridges to do automatic routing of event messages.     

                                                          Common                                
   Name                      Dest ID Event ID Simple Node        CAN format  Data Content
                                                          MTI    
   Consumer Range Identified N       Y        N           0x0000 0x1800,0sss Event ID with mask 

    

   Limit on occupancy of reported range.

4.5 Identify Producer

    

                                                  Common                          
   Name              Dest ID Event ID Simple Node        CAN format  Data Content
                                                  MTI    
   Identify Producer N       Y        N           0x0000 0x1800,0sss Event ID     

    

4.6 Producer Identified

    

                                                    Common                          
   Name                Dest ID Event ID Simple Node        CAN format  Data Content
                                                    MTI    
   Producer Identified N       Y        N           0x0000 0x1800,0sss Event ID     

   Coverage of status bits...

4.7 Producer Range Identified

   This message broadcasts, in response to a received Identify Producer message, from each node that
   produces events in the range specified by the included event-ID-with-mask.  This is one of the messages
   that allows bridges to do automatic routing of event messages.

                                                          Common                                
   Name                      Dest ID Event ID Simple Node        CAN format  Data Content
                                                          MTI    
   Producer Identified Range N       Y        N           0x0000 0x1800,0sss Event ID with mask 

    

   Limit on occupancy of reported range. May, but not required to, ...

4.8 Identify Events

   The two forms of this message are sent to request that the specified nodes report all the events they
   produce or consume.  These reports can be ether Identified messages specifying individual event IDs or
   ranges of events.  One form is an unaddressed message sent globally to all nodes, and the other is an
   addressed message to a specific node  

                                                Common                             
   Name            Dest ID Event ID Simple Node        CAN format     Data Content
                                                MTI    
   Identify Events N       N        N           0x2AB7 0x18AB,7sss                 
                   Y       N                    0x32B0 0x1Edd,dsss 2B              

    

   Coverage of status bits...

   Two forms of identify events; recommendation on uses for global form

                                             5 States (Normative)

    

   After the IC message is sent, and before any corresponding Producer/Consumer Event Report messages are
   sent, the node must identify all events produced or consumed on the board via zero or more Identify
   Consumers, Identify Consumed Range, Identify Producers and Identify Consumed Range messages. These are
   not required to be in any particular order.

                                          6 Interactions (Normative)

   Startup

   Enquiry

   Before sending a PCER message, producing a specific Event ID, the node shall emit a Producer Identified
   or Producer Range Identified message identifying that Event ID.  (This should be coded as a state
   machine)  This must be done again each time the node transitions to Initialized State.

   May not emit a PCER message unless it has emitted a PI or PRI message covering that event since the last
   time it emitted a IC message.

   (No need to send identify, etc, for automatically routed part of space.

   Does this talk about EventID assignment? Elsewhere: OpenLCB Event Identifiers Standard.

   Need a statement about “must forward to” or “must process” all PCER that cover event IDs in the
   particular state; that becomes a standard for gateway performance.  

   “nodes that process or forward PCER messages need not do so unless they have received ...”

    

   Table of Contents

   1 Introduction (Informative)

   2 Intended Use (Informative)

   3 References and Context (Normative)

   4 Message Formats (Normative)

   4.1 Producer/Consumer Event Report (PCER)

   4.2 Identify Consumer

   4.3 Consumer Identified

   4.4 Consumer Range Identified

   4.5 Identify Producer

   4.6 Producer Identified

   4.7 Producer Range Identified

   4.8 Identify Events

   5 States (Normative)

   6 Interactions (Normative)

    

   i The Producer/Consumer Model and Control System Design ControlLogix 1999
   https://cours.etsmtl.ca/gpa774/Cours/old-24-03-04/Documentations/Rockwell/articles/Producer_Consumer.html
